# 文件上传

---


## 通过django的admin后台上传文件
### 1、 `setting.py`文件中配置文件上传的路径  
```python
    MEDIA_ROOT=os.path.join(BASE_DIR,'media')        #项目的根路径下的media文件夹
    MEDIA_URL='/media/'
```
 
### 2、 `models.py`文件中，配置数据库的字段类型为图片  
```ptyhon
class TestData(models.Model):
    name=models.CharField(max_length=200)
    #upload表示上传的路径，此目录是在media目录的下一级目录
    image=models.ImageField(upload_to="upload/",default='media/shipin4.jpg')
```

###### 配置以上两项后，可在django后台管理页面上传图片，（上传文件则改为FileField）


## 通过前端页面上传文件
*以上不变*  
### 1、在`models.py`文件中创建form表单，并添加以下内容：
```python
class UploadFileForm(ModelForm):
    class Meta:
        model=TestData       #TestData为数据库中的一个表名
        fields=['name','file']        #只使用上传文件的表单，若需要上传图片，添加image即可
```

### 2、`views.py`视图文件：
```python
from django.shortcuts import render,HttpResponse

from .models import TestData
from .models import UploadFileForm

def upload_file(request):
    if request.method=='POST':
        form=UploadFileForm(request.POST,request.FILES)
        if form.is_valid():#表单数据如果合法
            upload_from=TestData()
            upload_from.name=form.cleaned_data['name']
            upload_from.file=form.cleaned_data['file']
            upload_from.save()#处理上传来的文件
            return HttpResponse('文件上传成功！')
    elif request.method=='GET':
        form=UploadFileForm()
        return render(request,'uploadFiles.html',{'form':form})
```

### 3、模板文件`uploadFiles.html`
```html
<form method="post" enctype="multipart/form-data".>
{nbsp; % nbsp;csrf_token nbsp; % nbsp;} <!--两边带上大括号，百分号，页面渲染原因，无法直接书写-->
{{form}}
<input type="submit" value="submit"/>
</form>
```  
##### 只有当request方法是POST，且发送request的form表单有属性`enctype="multipart/form-data"`时，request.FILES中才包含文件数据，否则request.FILES为空。

    

## 前端页面读取图片
### 1、urls.py文件中：

```python
from django.conf.urls.static import static
from django.conf import settings

urlpatterns=[
    #此处省略n行。。。
    ]+static(settings.MEDIA_URL,document_root=settings.MEDIA_ROOT)
```

### 2、setting文件
```python
TEMPLATES=[
    {
        'BACKEND':'django.template.backends.django.DjangoTemplates',
        #'DIRS':[],
        'DIRS':[BASE_DIR+"/templates",],
        'APP_DIRS':True,
        'OPTIONS':{
            'context_processors':[
                #省略n行
                'django.template.context_processors.media',#添加一个上下文环境,这个会自动的把MEDIA_URL注册到前端的模板中
            ],
        },
    },
]
```

### 3、在模板中直接使用 MEDIA_URL 变量.
```html
<img src="{{MEDIA_URL}}{{data.image}}"> #data为读取数据库获得的对象
```

访问页面时，图片的路径为： `src="/media/upload/timg.jpg"`
    