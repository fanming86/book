# 表单

----
Django表单系统的核心组件是 Form 类。它与Django模型描述对象的逻辑结构、行为以及它呈现给我们内容的形式的方式大致相同， Form 类描述一张表单并决定它如何工作及呈现  
来自django官网<https://docs.djangoproject.com/zh-hans/2.2/topics/forms/#html-forms>

## 准备工作
### 1、新建一个应用 forms 用于此次实验
```python
 python manage.py startapp forms
```

### 2、在django中注册新的应用，修改 `settings.py`
```python
# Application definition

INSTALLED_APPS = [
    ...
    'forms',
]
```

## 开始配置

### 1、配置路由 
##### `project/urls.py` *主路由*
```python
urlpatterns = [
    ...
    path('forms/',include('forms.urls'))
]
```
##### `forms/urls.py` *应用的路由*
```python
from forms import views

urlpatterns = [
    path('index',views.index)
]
```

### 2、在forms 应用中添加 `forms.py `

```python
from django import forms

class AddForm(forms.Form):
    name = forms.CharField()
    email = forms.EmailField()
    age = forms.IntegerField()

```
**django 表单字段参考<https://docs.djangoproject.com/zh-hans/2.2/ref/forms/fields/#django.forms.FloatField>**



### 3、配置视图函数`views.py`
```python
# 引入我们创建的表单类
from .forms import AddForm

def index(request):
    if request.method == 'POST':  # 当提交表单时
        form = AddForm(request.POST)  # form 包含提交的数据
        if form.is_valid():  # 如果提交的数据合法
            print(form.cleaned_data)    #可以获取请求中的值，只返回form表单中定义的字段，使用cleaned_data前，要验证表单
            name = form.cleaned_data['name']    #获取name 文本字段的值
            return HttpResponse('ok')
    else:  # 当正常访问时
        form = AddForm()
    return render(request, 'form.html', {'form': form})
```
>无论用表单提交了什么数据，一旦通过调用 is_valid() 验证成功（ is_valid() 返回 True ），已验证的表单数据将被放到 form.cleaned_data 字典中。这里的数据已经很好的为你转化为Python类型


### 4、创建html 文件 `templates/form.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>form demo</title>
</head>
<body>
<form action="/forms/index" method="POST">
    　<!--csrf 全称是 Cross Site Request Forgery-->
    {nbsp;%  csrf_token  %nbsp;}
    <div>
    {# 接收后台传过来的form对象，自动生成input标签#}
        {{ form }}
        <div>
            <input type="submit" value="提交"/>
        </div>
    </div>
</form>
</body>
</html>
```
    直接引用变量{{ form }}      ---a为render传递的参数，form中表单类名的实例化对象
    {{form.username }}   ---渲染出表单中的user文本框
    {{form.as_table }}   ---将表单输出为HTML <table>   整个表单
    {{form.as_p }}    ---将表单呈现为一系列<p>标记，每个标记<p> 包含一个字段


### 5、手动渲染表单
我们没有必要非要让Django来解包表单字段；我们可以手动来处理（比如，让我们对字段重新排序）。每个字段都可以用 {{ form.name_of_field }} 作为表单的一个属性，并被相应的渲染在Django模板中  

    {{field.errors }}  ---    输出一个包含对应该字段所有验证错误信息    
    {{field.id_for_label }}    ---    用于该字段的 ID  
    {{field.label }}      ---    字段的label，比如 Email address  

```html
<div>
    <label id="{{ form.email.id_for_label }}">{{ form.email.label }}:</label>
    {{ form.email }}
    {% if form.email.errors %}
        <span>{{ form.email.errors }}</span>
    {% endif %}
</div>
```

