# 自定义验证

---

## 

使用models.py 来构建表单时，自定义验证
例如： 从表单接收一个合格的手机号，使用正则表达时来验证手机号的合法性


```python
from django.db import models

# Create your models here.
from django.forms import ModelForm

from django.core.validators import ValidationError
import re

def mobile(value):
    # mobile = self.cleaned_data.get('phoneNum')
    print(value)
    if re.match(r'^(13\d|14[5|7]|15\d|166|17[3|6|7]|18\d)\d{8}$', value):
        return value
    else:
        raise ValidationError("手机号码非法", code='mobile invalid')

class addModel(models.Model):
    name = models.CharField(max_length=100)
    age = models.IntegerField()
    email = models.EmailField()
    phoneNum = models.CharField(max_length=11,validators=[mobile])

class AddForm(ModelForm):
    class Meta:
        model = addModel
        # fields = ['name', 'email']
        fields = '__all__'  # 将 fields 属性设置为特殊值 '__all__' 以表明需要使用模型中的所有字段

```

`views.py`

**当发现有不合法的数据的时候，将接收到的内容继续返回到页面，此时返回的form对象中包含errors信息**

```python
from .models import  AddForm

def index(request):
    if request.method == 'POST':
        form = AddForm(request.POST)
        if form.is_valid():
            form.save()
            return HttpResponse('ok')
        else:
            return render(request, 'form.html', {'form': form})
    else:
        form = AddForm()
    return render(request, 'form.html', {'form': form})

```